.\" Text automatically generated by txt2man
.TH TURN  "26 March 2013" "" ""
.SH GENERAL INFORMATION

The \fBTURN Server\fP project contains the source code of a TURN server and TURN client 
messaging library. Also, some extra programs provided, for testing-only 
purposes. 
.PP
See the INSTALL file for the building instructions.
.PP
After the build, you will have the following binary images:
.TP
.B
1.
\fIturnserver\fP: \fBTURN Server\fP relay. 
The compiled binary image of the \fBTURN Server\fP program is located in bin/ sub-directory.
.TP
.B
2.
\fIturnadmin\fP: TURN administration tool. This tool can be used to manage 
the user accounts (add/remove users, generate 
TURN keys for the users). For security reasons, we do not recommend 
storing passwords openly. The better option is to use pre-processed "keys" 
which are then used for authentication. These keys are generated by \fIturnadmin\fP. 
Turnadmin is a link to \fIturnserver\fP binary, but \fIturnadmin\fP performs different 
functions.
.TP
.B
3.
\fIuclient\fP: emulates multiple UDP,TCP,TLS or DTLS clients. 
(this program is provided for the testing purposes only !)
The compiled binary image of this program is located in examples/bin/ 
sub-directory.
.PP
WARNING: the \fIuclient\fP program is a primitive client application. 
It does not implement the re-transmission pattern that is necessary for 
a correct TURN client implementation. In TURN, the retransmission burden 
is lying almost entirely on the client application. We provide the messaging 
functionality in the client library, but the client must implement 
the correct Networking IO processing in the client program code.
.TP
.B
4.
\fIpeer\fP: a simple stateless UDP-only "echo" server, 
to be used as the final server in relay pattern ("\fIpeer\fP"). For every incoming 
UDP packet, it simply echoes it back.
(this program is provided for the testing purposes only !) 
When the test clients are communicating in the client-to-client manner 
(when the "\fIuclient\fP" program is used with "\fB-y\fP" option) then the \fIpeer\fP
is not needed.
.PP
The compiled binary image of this program is located in examples/bin/ subdirectory.
.TP
.B
5.
\fIstunclient\fP: a simple STUN client example. 
The compiled binary image of this program is located in examples/bin/ subdirectory.
.TP
.B
6.
\fIrfc5769check\fP: a utility that checks the correctness of the STUN/TURN protocol implementation.
.PP
In the "examples/scripts" subdirectory, you will find the examples of command lines to be used 
to run the programs. The scripts are meant to be run from examples/ subdirectory, for example:
.PP
$ cd examples
$ ./scripts/secure_relay.sh
.SH RUNNING THE TURN SERVER

Options note: \fIturnserver\fP and \fIturnadmin\fP have long and short option names, for most options.
Some options have only long form, some options have only short form. Their syntax 
somewhat different, if an argument is required:
.PP
The short form must be used as this (for example):
.PP
.nf
.fam C
  $ turnserver -L 12.34.56.78

.fam T
.fi
The long form equivalent must use the "=" character:
.PP
.nf
.fam C
  $ turnserver --listening-ip=12.34.56.78

.fam T
.fi
If this is a flag option (no argument required) then their usage are the same, for example:
.PP
.nf
.fam C
 $ turnserver -a

.fam T
.fi
is equivalent to:
.PP
.nf
.fam C
 $ turnserver --lt-cred-mech

.fam T
.fi
===============================================================================
.SS  NAME
\fB
\fBturnserver application is a TURN relay server implementation.
\fB
.SS  SYNOPSIS
.nf
.fam C

$ \fIturnserver\fP [\fB-n\fP | \fB-c\fP <config-file> ] [\fB-vfao\fP] [ \fB--userdb\fP=<userdb-file> | \fB--sql-userdb\fP=<db-conn-string> | \fB--mysql-userdb\fP=<db-conn-string> ] [\fB-z\fP | \fB--no-auth\fP | \fB-a\fP | \fB--lt-cred-mech\fP ] [\fIoptions\fP]
$ \fIturnserver\fP \fB-h\fP

.fam T
.fi
.fam T
.fi
.SS  DESCRIPTION                                           

.TP
.B
Config file setting:
.TP
.B
\fB-n\fP
Do not use configuration file, use only command line parameters.
.TP
.B
\fB-c\fP
Configuration file name (default - turnserver.conf).
The format of config file can be seen in
the supplied examples/etc/turnserver.conf example file. Long 
names of the \fIoptions\fP are used as the configuration 
items names in the file. If not an absolute path is supplied, 
then the file is searched in the following directories: 
.RS
.IP \(bu 3
current directory
.IP \(bu 3
current directory etc/ subdirectory
.IP \(bu 3
upper directory level etc/
.IP \(bu 3
/etc/
.IP \(bu 3
/usr/local/etc/
.IP \(bu 3
installation directory /etc
.RE
.TP
.B
\fB-b\fP, \fB--userdb\fP
\(cqDynamic' user database file name (default - turnuserdb.conf).
This user file database is being dynamically checked while the \fIturnserver\fP 
is working, and the user accounts can be changed dynamically by
editing the database.
.TP
.B
\fB-e\fP, \fB--sql-userdb\fP
User database connection string for PostgreSQL. You can either use 
flat file user database (\fB-b\fP option) or PostgreSQL database (\fB-e\fP option)
or MySQL database (\fB-M\fP option).
The connection string format (for example) is like this:
.RS
.PP
"host=localhost dbname=turn user=turn password=turn connect_timeout=30" (for 8.x Postgres).
.PP
Or:
.PP
"postgresql://username:password@hostname:port/databasename" (for 9.x Postgres). 
See the INSTALL file for more explanations and examples.
.PP
Also, see http://www.PostgreSQL.org for full PostgreSQL documentation.
.RE
.TP
.B
\fB-M\fP, \fB--mysql-userdb\fP
User database connection string for MySQL. You can either use 
flat file user database (\fB-b\fP option) or PostgreSQL database (\fB-e\fP option) or
MySQL database (\fB-M\fP option).
The connection string format (for example) is like this:
.RS
.PP
"host=localhost dbname=turn user=turn password=turn"
See the INSTALL file for more explanations and examples.
.PP
Also, see http://www.mysql.org for full MySQL documentation.
.RE
.TP
.B
Flags:
.TP
.B
\fB-v\fP, \fB--verbose\fP
Verbose.
.TP
.B
\fB-o\fP, \fB--daemon\fP
Run server as daemon.
.TP
.B
\fB-f\fP, \fB--fingerprint\fP
Use fingerprints in the TURN messages. If an incoming request
contains fingerprint, then TURN server will always add 
fingerprints to the messages in this session, regardless of the
per-server setting.
.TP
.B
\fB-a\fP, \fB--lt-cred-mech\fP
Use long-term credential mechanism.
.TP
.B
\fB-z\fP, \fB--no-auth\fP
Do not use any credential mechanism, allow anonymous access. 
Opposite to \fB-a\fP option. This is default option when no 
authentication-related \fIoptions\fP are set.
By default, no credential mechanism is used -
any user is allowed.
.TP
.B
\fB--no-udp\fP
Do not start UDP client listeners.
.TP
.B
\fB--no-tcp\fP
Do not start TCP client listeners.
.TP
.B
\fB--no-tls\fP
Do not start TLS client listeners.
.TP
.B
\fB--no-dtls\fP
Do not start DTLS client listeners.
.TP
.B
\fB--no-udp-relay\fP
Do not allow UDP relay endpoints, use only TCP relay option.
.TP
.B
\fB--no-tcp-relay\fP
Do not allow TCP relay endpoints, use only UDP relay option.
.TP
.B
\fB--stale-nonce\fP
Use extra security with nonce value having limited lifetime (600 secs). 
.TP
.B
\fB-h\fP
Help.
.TP
.B
Options with required values:
.TP
.B
\fB-d\fP, \fB--listening-device\fP
Listener interface device (optional functionality, Linux only). 
The \fIturnserver\fP process must have root privileges to bind the 
listening endpoint to a device. If \fIturnserver\fP must run as a 
process without root privileges, then just do not use this setting.
.TP
.B
\fB-L\fP, \fB--listening-ip\fP
Listener IP address of relay server. 
Multiple listeners can be specified:
\.\.\. \fB-L\fP ip1 \fB-L\fP ip2 \fB-L\fP ip3\.\.\."
If no \fBIP\fP(s) specified, then all IPv4 and 
IPv6 system IPs will be used for listening.
The same \fBip\fP(s) can be used as both listening and relay \fBip\fP(s).
.TP
.B
\fB-p\fP, \fB--listening-port\fP
TURN listener port for UDP and TCP listeners (Default: 3478).
.TP
.B
\fB--tls-listening-port\fP
TURN listener port for TLS and DTLS listeners (Default: 5349).
.TP
.B
\fB--alt-listening-port\fP
Alternative listening port for UDP and TCP listeners
(default value is 3479). This is needed for RFC 5780 support
(STUN extension specs, NAT behavior discovery). The \fBTURN Server\fP 
supports RFC 5780 only if it is started with more than one 
listening IP address of the same family (IPv4 or IPv6).
.TP
.B
\fB--alt-tls-listening-port\fP
Alternative listening port for TLS and DTLS protocols.
Default value is 5350.
.TP
.B
\fB-i\fP, \fB--relay-device\fP
Relay interface device for relay sockets 
(optional, Linux only).
.TP
.B
\fB-E\fP, \fB--relay-ip\fP
Relay address (the local IP address that 
will be used to relay the packets to the 
\fIpeer\fP). Multiple relay addresses may be used:
\.\.\. \fB-E\fP ip1 \fB-E\fP ip2 \fB-E\fP ip3 \.\.\.
If no relay \fBIP\fP(s) specified, then all 
non-loopback system IPs will be used.
The same \fBip\fP(s) can be used as both listening and relay \fBip\fP(s).
.TP
.B
\fB-X\fP, \fB--external-ip\fP
"External" \fBTURN Server\fP address if the server is behind NAT.
In the server-behind-NAT situation, only one relay address must be used, and
that single relay address must be mapped by NAT to the 'external' IP.
For this 'external' IP, NAT must forward ports directly (relayed port 12345
must be always mapped to the same 'external' port 12345).
This value, if not empty, is returned in XOR-RELAYED-ADDRESS field.
By default, this value is empty, and the real relay IP address is used.
.TP
.B
\fB-m\fP, \fB--relay-threads\fP
number of extra threads to handle the 
established connections.
By default, everything in handled in single thread 
(the default number of extra threads is 0).
.TP
.B
\fB--min-port\fP
Lower bound of the UDP port range for relay 
endpoints allocation.
Default value is 49152, according to RFC 5766.
.TP
.B
\fB--max-port\fP
Upper bound of the UDP port range for relay 
endpoints allocation.
Default value is 65535, according to RFC 5766.
.TP
.B
\fB-u\fP, \fB--user\fP
User account, in the column-separated 
form 'username:key'. 
The key is either the user password, or
the key is generated
by \fIturnadmin\fP command. In the second case,
the key must be prepended with '0x' symbols.
The key is calculated over the user name, 
the realm, and the user password.
.TP
.B
\fB-r\fP, \fB--realm\fP
Realm to be used for all users.
.TP
.B
\fB-q\fP, \fB--user-quota\fP
Per-user allocations quota: how many concurrent 
allocations a user can create.
.TP
.B
\fB-Q\fP, \fB--total-quota\fP
Total allocations quota: global limit on concurrent allocations.
.TP
.B
\fB-s\fP, \fB--max-bps\fP
Max bytes-per-second bandwidth a TURN session is allowed to handle
(input and output network streams combined). Anything above that limit
will be dropped.
.TP
.B
\fB--cert\fP
Certificate file, PEM format. Same file 
search rules applied as for the configuration 
file. If both \fB--no-tls\fP and \fB--no-dtls\fP \fIoptions\fP 
are specified, then this parameter is not needed.
Default value is turn_server_cert.pem.
.TP
.B
\fB--pkey\fP
Private key file, PEM format. Same file 
search rules applied as for the configuration 
file. If both \fB--no-tls\fP and \fB--no-dtls\fP \fIoptions\fP 
are specified, then this parameter is not needed.
Default value is turn_server_pkey.pem.
.PP
===============================================================================
.SS  NAME
\fB
\fBturnadmin application is a TURN relay administration tool.
\fB
.SS  SYNOPSIS  

$ \fIturnadmin\fP [command] [\fIoptions\fP]
.PP
$ \fIturnadmin\fP [ \fB-h\fP | \fB--help\fP]
.SS  DESCRIPTION

.TP
.B
Commands:
.TP
.B
\fB-k\fP, \fB--key\fP
Generate key for a user.
.TP
.B
\fB-a\fP, \fB--add\fP
Add or update a user.
.TP
.B
\fB-d\fP, \fB--delete\fP
Delete a user.
.TP
.B
Options with required values:
.TP
.B
\fB-b\fP, \fB--userdb\fP
File-based user database file name (default - turnuserdb.conf).
See the \fB--userdb\fP option in the \fIturnserver\fP section.
.TP
.B
\fB-e\fP, \fB--sql-userdb\fP
PostgreSQL user database connection string.
See the \fB--sql-userdb\fP option in the \fIturnserver\fP section.
.TP
.B
\fB-M\fP, \fB--mysql-userdb\fP
MySQL user database connection string.
See the \fB--mysql-userdb\fP option in the \fIturnserver\fP section.
.TP
.B
\fB-u\fP, \fB--user\fP
User name.
.TP
.B
\fB-r\fP, \fB--realm\fP
Realm.
.TP
.B
\fB-p\fP, \fB--password\fP
Password.
.TP
.B
\fB-h\fP, \fB--help\fP
Help.
.TP
.B
Generate a key:
.PP
$ \fIturnadmin\fP \fB-k\fP \fB-u\fP <username> \fB-r\fP <realm> \fB-p\fP <password>
.PP
Add/update a user (and realm) in the userdb file or in the database:
.PP
$ \fIturnadmin\fP \fB-a\fP [\fB-b\fP <userdb-file> | \fB-e\fP <db-connection-string> | \fB-M\fP <db-connection-string> ] \fB-u\fP <username> \fB-r\fP <realm> \fB-p\fP <password>
.PP
Delete a user from the userdb file or from the database:
.PP
$ \fIturnadmin\fP \fB-d\fP [\fB-b\fP <userdb-file> | \fB-e\fP <db-connection-string> | \fB-M\fP <db-connection-string> ] \fB-u\fP <username>
.TP
.B
Help:
.PP
$ \fIturnadmin\fP \fB-h\fP
.PP
==================================================================================
.SS  NAME
\fB
\fBuclient application is for test purposes only.
\fB
.SS  SYNOPSIS  

$ \fIuclient\fP [\fB-tSvsyhcxg\fP] [\fIoptions\fP] <TURN-Server-IP-address>
.SS  DESCRIPTION

It was designed to simulate multiple clients. It uses asynch IO API in 
libevent to handle multiple clients. A client connects to the relay, 
negotiates the session, and sends multiple (configured number) messages to the server (relay), 
expecting the same number of replies. The length of the messages is configurable. 
The message is an arbitrary octet stream, but it can be configured as a string. 
The number of the messages to send is configurable.
.TP
.B
Flags:
.TP
.B
\fB-t\fP
Use TCP (default is UDP).
.TP
.B
\fB-T\fP
TCP relay transport (default - UDP). Implies \fIoptions\fP \fB-t\fP, \fB-y\fP, \fB-c\fP, and ignores 
flags and \fIoptions\fP \fB-s\fP, \fB-e\fP, \fB-r\fP and \fB-g\fP.
.TP
.B
\fB-S\fP
Secure connection: TLS for TCP, DTLS for UDP.
.TP
.B
\fB-v\fP
Verbose.
.TP
.B
\fB-s\fP
Use "Send" method in TURN; by default, it uses TURN Channels.
.TP
.B
\fB-y\fP
Use client-to-client connections: 
RTP/RTCP pair of channels to another RTP/RTCP pair of channels.
with this option the \fIpeer\fP application is not used,
as the allocated relay endpoints are talking to each other.
.TP
.B
\fB-h\fP
Hang on indefinitely after the last sent packet.
.TP
.B
\fB-c\fP
Do not create rtcp connections.
.TP
.B
\fB-x\fP
Request IPv6 relayed address (RFC6156).
.TP
.B
\fB-g\fP
Set DONT_FRAGMENT parameter in TURN requests.
.TP
.B
Options with required values:
.TP
.B
\fB-l\fP
Message length (Default: 100 Bytes).
.TP
.B
\fB-i\fP
Certificate file (for secure connections only).
.TP
.B
\fB-k\fP
Private key file (for secure connections only).
.TP
.B
\fB-p\fP
\fBTURN Server\fP port (Defaults: 3478 unsecure, 5349 secure).
.TP
.B
\fB-n\fP
Number of messages to send (Default: 5).
.TP
.B
\fB-d\fP
Local interface device (optional, Linux only).
.TP
.B
\fB-L\fP
Local IP address (optional).
.TP
.B
\fB-m\fP
Number of clients (Default: 1, 2 or 4, depending on \fIoptions\fP).
.TP
.B
\fB-e\fP
Peer address.
.TP
.B
\fB-r\fP
Peer port (Default: 3480).
.TP
.B
\fB-z\fP
Per-session packet interval in milliseconds (Default: 20).
.PP
See the examples in the "examples/scripts" directory.
.PP
====================================================================================
.SS  NAME
\fB
\fBpeer application is a simple UDP-only echo backend server.
\fB
.SS  SYNOPSYS

$ \fIpeer\fP [\fB-v\fP] [\fIoptions\fP]
.SS  DESCRIPTION

This application is used for the test purposes only, as a '\fIpeer\fP' for the \fIuclient\fP application.
.TP
.B
Options with required values:
.TP
.B
\fB-p\fP
Listening UDP port (Default: 3480).
.TP
.B
\fB-d\fP
Listening interface device (optional)
.TP
.B
\fB-L\fP
Listening address of \fIpeer\fP server. Multiple listening addresses can be used, IPv4 and IPv6.
.TP
.B
\fB-v\fP
Verbose
.PP
===================================================================================
.SS  NAME
\fB
\fBstunclient is a basic STUN client.
\fB
.SS  SYNOPSIS
.nf
.fam C

$ \fIstunclient\fP [\fIoptions\fP] <STUN-Server-IP-address>

.fam T
.fi
.fam T
.fi
.SS  DESCRIPTION

It sends a STUN request (over UDP) and shows the reply information.
.TP
.B
Options with required values:
.TP
.B
\fB-p\fP
STUN server port (Default: 3478).
.TP
.B
\fB-L\fP
Local address to use (optional).
.PP
The \fIstunclient\fP program checks the results of the first request, 
and if it finds that the STUN server supports RFC 5780 
(the binding response reveals that) then the \fIstunclient\fP makes a couple more 
requests with different parameters, to demonstrate the NAT discovery capabilities.
.PP
===================================================================================
.SS  NAME
\fB
\fBrfc5769check tests the correctness of STUN protocol implementation.
\fB
.SS  SYNOPSIS
.nf
.fam C

$ \fIrfc5769check\fP

.fam T
.fi
.fam T
.fi
.SS  DESCRIPTION

\fIrfc5769check\fP tests the correctness of STUN protocol implementation 
against the test vectors predefined in RFC 5769 and prints the results of the tests on the screen.
.TP
.B
Usage:
.PP
$ \fIrfc5769check\fP
.PP
===================================================================================
.SH LIBRARIES

In the lib/ sub-directory the build process will create TURN client messaging library.
In the include/ sub-directory, the necessary include files will be placed.
The C++ wrapper for the messaging functionality is located in TurnMsgLib.h header.
An example of C++ code can be found in stunclient.c file. 
.PP
===================================================================================
.SH DOCS

After installation, run the command:
.PP
$ man \fIturnserver\fP
.PP
or in the project root directory:
.PP
$ man \fB-M\fP man \fIturnserver\fP
.PP
to see the man page.
.PP
In the docs/html subdirectory of the original archive tree, you will find the client library 
reference. After the installation, it will be placed in PREFIX/share/doc/\fIturnserver\fP/html.
.PP
===================================================================================
.SH LOGS

When the \fBTURN Server\fP starts, it makes efforts to create a log file turn_<pid>.log 
in the following directories:
.RS
.IP \(bu 3
/var/log
.IP \(bu 3
/log/
.IP \(bu 3
/var/tmp
.IP \(bu 3
/tmp
.IP \(bu 3
current directory
.RE
.PP
If all efforts failed (due to the system permission settings) then all 
log messages are sent only to the standard output of the process.
.PP
===================================================================================
.SH CLUSTERS

\fBTURN Server\fP can be a part of the cluster installation. But, to support the "even port" functionality 
(RTP/RTCP streams pairs) the client requests from a particular IP must be delivered to the same 
\fBTURN Server\fP instance, so it requires some networking setup massaging for the cluster. The reason is that 
the RTP and RTCP relaying endpoints must be allocated on the same relay IP. It would be possible 
to design a scheme with the application-level requests forwarding (and we may do that later) but 
it would affect the performance.
.PP
===================================================================================
.SH FILES

/etc/turnserver.conf
.PP
/etc/turnuserdb.conf
.PP
/usr/local/etc/turnserver.conf
.PP
/usr/local/etc/turnuserdb.conf
.PP
===================================================================================
.SH STANDARDS

new STUN RFC 5389
.PP
TURN RFC 5766
.PP
TURN-TCP extention RFC 6062
.PP
TURN IPv6 extention RFC 6156
.PP
STUN/TURN test vectors RFC 5769
.PP
STUN NAT behavior discovery RFC 5780
.PP
===================================================================================
.SH AUTHORS

Oleg Moskalenko <mom040267@gmail.com>
