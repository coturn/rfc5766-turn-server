I. DOWNLOAD

You have to download the archive file turnserver-*.tar.gz and unpack it:

$ tar xfz turnserver-*.tgz

it will create the directory 'turnserver-*' with all sources, build files, 
examples and documentation.

II. BUILD

If you are sure that you system is ready for the build (see the section 
"Extra libraries and Utilities" below) then you can build the system.
First, you have to run the configure script:

	$ cd turnserver-*
	$ ./configure
	
It will create a Makefile customized for your system. 

By default, the generated Makefile will be set to install everything
in /usr/local directory. You can change that and some other settings my 
setting PREFIX variable in the command line. Compilation and linking options
can be customized, too. For example:

	$ PREFIX=/opt CFLAGS=-D_CAURIB LDFLAGS=-lshanka ./configure   

The script configure is a proprietary script. It will create a Makefile 
that you can use to build the project:

	$ make

The make command will do the following:
 - create bin/ sub-directory and put the TURN server and TURN admin programs there.
 - create lib/ sub-directory and put the client library there.
 - create include/turn/ sub-directory and put include files there.
 - create examples/bin/ sub-directory and put all tests program there.

The programs can be either called directly, or a shell scripts can be used. 
The script examples are located in examples/scripts directory. These scripts are just 
examples: you can run them successfully for the tests, but
you will have to change the script parameters for your real environment.

The command:

	$ make install 

will install everything into the system file structure (see below).

The command:

	$ make deinstall
	
will remove all installed TURN Server files from your system.

The command:

	$ make clean 
	
will clean all results of the build and configuration actions.

Do not run "make clean" before "make deinstall". The "clean" command will
remove the Makefile and you will not be able to "deinstall" it then. If that 
has happened, then run ./configure and make again, then deinstall and then clean.

NOTE: On most modern systems, the build will produce dynamically linked 
executables. If you want statically linked executables, you have to modify, 
accordingly, the Makefile.

III. INSTALL

run command:

$ make install

It will install turnserver in /usr/local/ directory (or to whatever directory
was set in the PREFIX variable). You will have to change 
/usr/local/etc/turnserver.conf file to adjust your runtime configuration.

This command will also copy the content of examples subdirectory into 
PREFIX/examples/turn/ directory.

IV. PLATFORMS

The TURN Server is using generic *NIX system APIs and is supposed to be usable 
on wide range of *NIX systems. 

The following platforms have been used in the development:

	- Linux Ubuntu 11.x and 12.x, i386 and x86_64
	- FreeBSD 6.x, i386
	- FreeBSD 8.x, i386
	- PC-BSD 9.x, x86_64
	- Solaris 11, x86_64
	- Linux CentOS / Red Hat Enterprise Edition 6.3, x86_64
	- Linux Debian 'squeeze', i386

It must work on many other *NIXes, as well. The configure script and/or 
Makefile may need adjustments for other *NIXes not mentioned above.

The code of the client messaging library can be compiled and used on 
Windows, too, but it is not supported for now.

V. COMPILERS

The TURN Server is written in C programming language, for portability 
and for the performance reasons. 

The tested C compilers are:

	- gcc 3.4.6 thru 4.7.2
	- clang 3.0 or better
	- Solaris Studio 12.3 C compiler, version 5.12

It may be compiled with others compilers, too.

The code is compatible with C++ compiler, and a C++ compiler
(like g++) can be used for the compilation, too:

	$ CC=g++ ./configure
	$ make

VI. EXTRA LIBRARIES AND UTILITIES

In addition to common *NIX OS services and libraries, to compile this code, 
OpenSSL (version 1.0.0a or better is recommended) and libevent2 (version 2.0.5 
or better) are required. For build, both must be installed
in full version (development headers and runtime libraries). For runtime, 
only runtime setup is required. If the build is modified for static linking, 
then even runtime installation is not needed.

OpenSSL and libevent2 can be downloaded from their web sites -
http://www.openssl.org and http://www.libevent.org. The installation
is pretty straightforward - the usual "./configure" and "make install" commands.
Install them into their default locations - the configure script and
the Makefile are assuming that they are installed in their default locations.
If not, then you will have to modify those.

FreeBSD, PC-BSD and Linux Ubuntu 11.10+ have even simpler way of the
third party tools installation:      

	*) PC-BSD or FreeBSD (the ports database is assumed to be installed):

		$ cd /usr/ports/security/openssl/
		$ sudo make install
		$ cd /usr/ports/devel/libevent2/
		$ sudo make install

	**) Linux Ubuntu 11.10 or later:
		
		$ sudo apt-get install libssl-dev
		$ sudo apt-get install libevent-dev
		
		or you can use Synaptic or other software center. 

NOTE: OpenSSL to be installed before libevent2. When libevent2 is building, it 
is checking whether OpenSSL has been already installed, and which version of 
OpenSSL. If the OpenSSL is missed, or too old, then libevent_openssl library is 
not being created during the build, and you will not be able to compile the 
TURN Server with TLS support.

NOTE: An older libevent version, version 1.x.x, is often included in some *NIX 
distributions. That version has its deficiencies and is inferior to the newer 
libevent2, especially in the performance department. This is why we are 
not providing backward compatibility with the older libevent version. 
If you have a system with older libevent, then you have to install the new 
libevent2 from their web site. It was tested on older *NIXes and it works 
just fine. 

NOTE: OpenSSL version 1.0.0a or newer is recommended. Older versions do not 
support DTLS, reliably. For example, the Debian 'squeeze' Linux with 
supplied 0.9.8 version of OpenSSL, does not work correctly with DTLS over IPv6. 

VII. TEST

First of all, we can use test vectors from RFC 5769 to double-check that our STUN/TURN 
message encoding algorithms work properly. Run the utility:

 $ cd examples
 $ ./scripts/rfc5769.sh
 
It will perform several protocol checks and print the results on the output. If anything
has compiled wrongly (TURN Server, or OpenSSL libraries) then you will see some errors.

Now, the TURN functionality test:

If everything compiled properly, then the following programs must run 
together successfully, simulating TURN network routing in local loopback
networking environment:

Open three shell screens or consoles:

In shell number 1, run peer application (from build directory): 
 $ cd examples
 $ ./scripts/peer.sh

In shell number 2, run local TURN server application:
 $ cd examples
 $ ./scripts/relay.sh

In shell number 3, run test client application:

 $ cd examples
 $ ./scripts/udp_client.sh

or

 $ cd examples
 $ ./scripts/tcp_client.sh

If the client application produces output and in approximately 22 seconds prints 
the jitter, loss and round-trip-delay statistics, then everything is fine.

There is a similar set of examples/scripts/secure_* scripts for TURN environment 
with authentication.

The provided scripts are for the local loopback communications, as an example and 
as a test environment. Real networking IPs must be used in real scripts.

Try wireshark to check the communications between client, turnserver and the peer. 

Check the README file and the comments in the scripts relay.sh and secure_relay.sh 
as a guidance how to run the TURN server.

VIII. CLIENT API LIBRARY.

The compilation process will create lib/ sub-directory with libturnclient.a library. 
The header files for this library are located in include/turn/client/ sub-directory.
The C++ wrapper for the messaging functionality is located in TurnMsgLib.h header.
An example of C++ code can be found in stunclient.c file. This file is compiled as a 
C++ program if C++ compiler is used, and as a C program if C compiler is used.

IX. DOCS

After installation, the man page turnserver(1) must be available. The man page is 
located in man/man1 subdirectory. If you want to see the man page without 
installation, run the command:

	$	man -M man turnserver

HTML-formatted client library functions reference is located in docs/html subdirectory.
